# Начало работы с IPython и Jupyter
При написании кода Python для науки о данных я обычно использую три режима работы: я использую оболочку IPython для отработки коротких последовательностей команд, Jupyter Notebook для более длительного интерактивного анализа и обмена контентом с другими, а также интерактивные среды разработки (IDE), такие как Emacs или VSCode, для создания повторно используемых пакетов Python.
В этой главе основное внимание уделяется первым двум режимам: оболочке IPython и Jupyter Notebook.
Использование IDE для разработки программного обеспечения является важным третьим инструментом в арсенале специалиста по анализу данных, но мы не будем рассматривать его здесь напрямую.
## Запуск оболочки IPython
Текст этой части, как и большая часть этой книги, не предназначен для пассивного усвоения.
Я рекомендую вам по мере прочтения материала следовать за ним и экспериментировать с инструментами и синтаксисом, которые мы рассмотрим: мышечная память, которую вы разовьете, делая это, будет гораздо полезнее, чем простое чтение об этом.
Начните с запуска интерпретатора IPython, введя **`ipython`** в командной строке; в качестве альтернативы, если вы установили такой дистрибутив, как Anaconda или EPD, может быть средство запуска, специально предназначенное для вашей системы.
После этого вы увидите примерно следующее сообщение:
```ipython
Python 3.9.2 (v3.9.2:1a79785e3e, 19 фев 2021, 09:06:10)
Для получения дополнительной информации введите «авторское право», «кредиты» или «лицензия».
IPython 7.21.0 — улучшенный интерактивный Python. Введите «?» для справки.
В [1]:
```
Теперь вы готовы следовать дальше.
## Запуск Jupyter Notebook
Jupyter Notebook — это графический интерфейс на основе браузера для оболочки IPython, на основе которого создан богатый набор возможностей динамического отображения.
Помимо выполнения операторов Python/IPython, блокноты позволяют пользователю включать форматированный текст, статические и динамические визуализации, математические уравнения, виджеты JavaScript и многое другое.
Более того, эти документы можно сохранить таким образом, чтобы другие люди могли открыть их и выполнить код на своих собственных системах.
Хотя вы можете просматривать и редактировать блокноты Jupyter через окно веб-браузера, для выполнения кода они должны подключаться к запущенному процессу Python.
Вы можете запустить этот процесс (известный как «ядро»), выполнив следующую команду в системной оболочке:
```
$ лаборатория jupyter
```
Эта команда запустит локальный веб-сервер, который будет виден вашему браузеру.
Он немедленно выдает журнал, показывающий, что он делает; этот журнал будет выглядеть примерно так:
```
$ лаборатория jupyter
[ServerApp] Обслуживание блокнотов из локального каталога: /Users/jakevdp/PythonDataScienceHandbook
[ServerApp] Jupyter Server 1.4.1 работает по адресу:
[ServerApp] http://localhost:8888/lab?token=dd852649
[ServerApp] Используйте Control-C, чтобы остановить этот сервер и завершить работу всех ядер (нажмите дважды, чтобы пропустить подтверждение).
```
После ввода команды ваш браузер по умолчанию должен автоматически открыться и перейти по указанному локальному URL-адресу;
Точный адрес будет зависеть от вашей системы.
Если браузер не открывается автоматически, вы можете открыть окно и вручную открыть этот адрес (*http://localhost:8888/lab/* в этом примере).
## Справка и документация в IPython
Если вы не читали другие разделы этой главы, прочтите этот: Я считаю, что обсуждаемые здесь инструменты являются наиболее преобразующим вкладом IPython в мой повседневный рабочий процесс.
Когда технически подкованного человека просят помочь другу, члену семьи или коллеге решить проблему с компьютером, в большинстве случаев речь идет не столько о знании ответа, сколько о умении быстро найти неизвестный ответ.
В науке о данных то же самое: доступные для поиска веб-ресурсы, такие как онлайн-документация, темы почтовых рассылок и ответы Stack Overflow, содержат огромное количество информации, даже (особенно?) по темам, которые вы уже искали ранее.
Эффективность специалиста в области науки о данных заключается не столько в запоминании инструментов или команд, которые следует использовать в каждой возможной ситуации, сколько в умении эффективно находить неизвестную информацию, будь то с помощью поисковой системы в Интернете или другими способами.
Одной из самых полезных функций IPython/Jupyter является сокращение разрыва между пользователем и типом документации и поиска, что поможет ему эффективно выполнять свою работу.
Хотя веб-поиск по-прежнему играет определенную роль в поиске ответов на сложные вопросы, с помощью одного только IPython можно найти невероятное количество информации.
Вот несколько примеров вопросов, на которые IPython может помочь ответить несколькими нажатиями клавиш:
- Как вызвать эту функцию? Какие у нее аргументы и параметры?
- Как выглядит исходный код этого объекта Python?
- Что находится в этой посылке, которую я импортировал?
- Какие атрибуты или методы есть у этого объекта?
Здесь мы обсудим инструменты, предоставляемые оболочкой IPython и Jupyter Notebook для быстрого доступа к этой информации, а именно символ `?` для просмотра документации, символы `??` для просмотра исходного кода и клавишу Tab для автодополнения.
### Доступ к документации с помощью ?
Язык Python и его экосистема науки о данных созданы с учетом потребностей пользователя, и важной частью этого является доступ к документации.
Каждый объект Python содержит ссылку на строку, известную как *docstring*, которая в большинстве случаев будет содержать краткое описание объекта и того, как его использовать.
В Python есть встроенная функция `help`, которая может получить доступ к этой информации и вывести результаты.
Например, чтобы просмотреть документацию встроенной функции `len`, вы можете сделать следующее:
```ipython
In [1]: help(len)
Help on built-in function len in module builtins:

len(obj, /)
    Return the number of items in a container.
```
В зависимости от вашего интерпретатора эта информация может отображаться в виде встроенного текста или в отдельном всплывающем окне.
Поскольку поиск справки по объекту настолько распространен и полезен, IPython и Jupyter вводят символ ``?`` в качестве сокращенного обозначения для доступа к этой документации и другой соответствующей информации:
```ipython
In [2]: len?
Signature: len(obj, /)
Docstring: Return the number of items in a container.
Type:      builtin_function_or_method
```
Эта нотация применима практически ко всему, включая методы объектов:
```ipython
In [3]: L = [1, 2, 3]
In [4]: L.insert?
Signature: L.insert(index, object, /)
Docstring: Insert object before index.
Type:      builtin_function_or_method
```
или даже сами объекты, с документацией по их типу:

```ipython
In [5]: L?
Type:        list
String form: [1, 2, 3]
Length:      3
Docstring:  
Built-in mutable sequence.

If no argument is given, the constructor creates a new empty list.
The argument must be an iterable if specified.
```
Что важно, это будет работать даже для функций или других объектов, которые вы создаете сами!
Здесь мы определим небольшую функцию со строкой документации:
```ipython
In [6]: def square(a):
  ....:     """Return the square of a."""
  ....:     return a ** 2
  ....:
```
Обратите внимание: чтобы создать строку документации для нашей функции, мы просто поместили строковый литерал в первую строку.
Поскольку строки документации обычно состоят из нескольких строк, по соглашению мы использовали обозначение Python с тройными кавычками для многострочных строк.
Теперь мы воспользуемся  `?`, чтобы найти эту строку документации:
```ipython
In [7]: square?
Signature: square(a)
Docstring: Return the square of a.
File:      <ipython-input-6>
Type:      function
```
Такой быстрый доступ к документации через строки документации — одна из причин, по которой вам следует выработать привычку всегда добавлять такую ​​встроенную документацию в код, который вы пишете!
### Доступ к исходному коду с помощью ??
Поскольку язык Python настолько легко читается, обычно можно получить еще более глубокое понимание, прочитав исходный код интересующего вас объекта.
IPython и Jupyter предоставляют ярлык исходного кода с помощью двойного вопросительного знака (`??`):
```ipython
In [8]: square??
Signature: square(a)
Source:   
def square(a):
    """Return the square of a."""
    return a ** 2
File:      <ipython-input-6>
Type:      function
```
Для таких простых функций двойной вопросительный знак может дать быстрый взгляд на скрытые детали.
Если вы поэкспериментируете с этим, то заметите, что иногда суффикс `??` не отображает никакого исходного кода: обычно это происходит потому, что рассматриваемый объект реализован не на Python, а на C или каком-либо другом компилируемом языке расширений.
В этом случае суффикс `??` даст тот же результат, что и суффикс `?`.
Это особенно заметно во многих встроенных объектах и ​​типах Python, включая функцию `len`, рассмотренную ранее:
```ipython
In [9]: len??
Signature: len(obj, /)
Docstring: Return the number of items in a container.
Type:      builtin_function_or_method
```
Использование `?` и/или `??` — это эффективный и быстрый способ найти информацию о том, что делает любая функция или модуль Python.
### Изучение модулей с помощью Tab Completion
Еще одним полезным интерфейсом является использование клавиши Tab для автодополнения и исследования содержимого объектов, модулей и пространств имен.
В следующих примерах я буду использовать `<TAB>`, чтобы указать, когда следует нажимать клавишу Tab.
#### Дополнение содержимого объекта нажатием клавиши Tab
С каждым объектом Python связаны различные атрибуты и методы.
Как и упомянутая ранее функция `help`, в Python есть встроенная функция `dir`, которая возвращает список этих функций, но интерфейс автодополнения клавишей Tab гораздо проще в использовании на практике.
Чтобы просмотреть список всех доступных атрибутов объекта, вы можете ввести имя объекта, затем символ точки ("`.`") и клавишу Tab:
```ipython
In [10]: L.<TAB>
            append() count    insert   reverse 
            clear    extend   pop      sort    
            copy     index    remove            
```
Чтобы сузить список, вы можете ввести первый символ или несколько символов имени, и клавиша Tab найдет соответствующие атрибуты и методы:
```ipython
In [10]: L.c<TAB>
             clear() count()
             copy()         

In [10]: L.co<TAB>
              copy()  count()
```
Если доступен только один вариант, нажатие клавиши Tab завершит строку.
Например, следующее будет мгновенно заменено на `L.count`:
```ipython
In [10]: L.cou<TAB>
```
Хотя в Python нет строго определенного различия между публичными/внешними атрибутами и приватными/внутренними атрибутами, по соглашению для обозначения последних используется предшествующее подчеркивание.
Для ясности эти частные методы и специальные методы по умолчанию исключены из списка, но их можно перечислить, явно введя символ подчеркивания:
```ipython
In [10]: L._<TAB>
           __add__             __delattr__     __eq__      
           __class__           __delitem__     __format__()
           __class_getitem__() __dir__()       __ge__            >
           __contains__        __doc__         __getattribute__       
```
Для краткости я показал только первые несколько столбцов вывода.
Большинство из них — это специальные методы Python с двойным подчеркиванием (часто называемые «методами дандер»).
#### Автодополнение при импорте
Функция автодополнения клавишей Tab также полезна при импорте объектов из пакетов.
Здесь мы воспользуемся им, чтобы найти все возможные импорты в пакете `itertools`, начинающиеся с `co`:
```ipython
В [10]: из itertools import co<TAB>
         комбинации() сжатие()
         комбинации_с_заменой() количество()
```
Аналогичным образом вы можете использовать автодополнение клавишей Tab, чтобы увидеть, какие импорты доступны в вашей системе (это будет меняться в зависимости от того, какие сторонние скрипты и модули видны в вашем сеансе Python):
```ipython
В [10]: импорт <TAB>
            abc аньио                          
            активировать_этот appdirs                        
            aifc приложение >
            антигравитационный аргон2                         
В [10]: импорт h<TAB>
            хэшлиб html   
            heapq http   
            hmac        
```
#### Помимо автодополнения по табуляции: сопоставление с помощью подстановочных знаков
Функция автодополнения с помощью клавиши Tab полезна, если вы знаете первые несколько символов имени объекта или атрибута, который ищете, но бесполезна, если вам нужны символы в середине или в конце имени.
Для этого варианта использования IPython и Jupyter предоставляют средства подстановочного сопоставления для имен с использованием символа `*`.
Например, мы можем использовать это для составления списка всех объектов в пространстве имен, имя которых заканчивается на `Warning`:
```ipython
В [10]: *Предупреждение?
БайтыПредупреждение Время выполненияПредупреждение
Предупреждение об устаревании Синтаксис Предупреждение
Предупреждение о будущем UnicodeWarning
ИмпортПредупреждение ПользовательПредупреждение
ОжиданиеУстареваниеПредупреждение Предупреждение
РесурсПредупреждение
```
Обратите внимание, что символ `*` соответствует любой строке, включая пустую строку.
Аналогично, предположим, что мы ищем строковый метод, содержащий слово `find` где-то в своем имени.
Мы можем искать его следующим образом:
```ipython
В [11]: str.*find*?
ул.найти
str.rfind
```
Я считаю, что этот тип гибкого поиска по подстановочным знакам может быть полезен для поиска определенной команды при знакомстве с новым пакетом или повторном знакомстве со знакомым пакетом.