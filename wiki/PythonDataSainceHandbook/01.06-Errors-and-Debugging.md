# Ошибки и отладка
Разработка кода и анализ данных всегда требуют проб и ошибок, и IPython содержит инструменты для оптимизации этого процесса.
В этом разделе будут кратко рассмотрены некоторые параметры управления отчетами об исключениях Python, а затем будут рассмотрены инструменты для отладки ошибок в коде.
## Управление исключениями: %xmode
В большинстве случаев при сбое скрипта Python возникает исключение.
Когда интерпретатор сталкивается с одним из таких исключений, информацию о причине ошибки можно найти в *traceback*, доступ к которому можно получить из Python.
С помощью магической функции `%xmode` IPython позволяет контролировать объем информации, выводимой при возникновении исключения.
Рассмотрим следующий код:
```питон
определение функции1(a, b):
    возврат а / б
определение функции2(x):
    а = х
    б = х - 1
    вернуть функцию1(a, b)
```
```питон
функция2(1)
```
    -------------------------------------------------- -------------------------
    ZeroDivisionError Traceback (последний вызов последний)
    Ячейка In[2], строка 1
    ----> 1 функция2(1)
    
    Ячейка In[1], строка 7, в func2(x)
          5 а = х
          6 б = х - 1
    ----> 7 вернуть функцию1(a, b)
    
    Ячейка In[1], строка 2, в func1(a, b)
          1 определение функции1(a, b):
    ----> 2 вернуть а / б
    
    ZeroDivisionError: деление на ноль
Вызов `func2` приводит к ошибке, а чтение распечатанной трассировки позволяет нам увидеть, что именно произошло.
В режиме по умолчанию эта трассировка включает несколько строк, показывающих контекст каждого шага, приведшего к ошибке.
Используя магическую функцию `%xmode` (сокращение от *исключительный режим*), мы можем изменить выводимую информацию.
`%xmode` принимает один аргумент — режим, и существует три варианта: `Plain`, `Context` и `Verbose`.
Значение по умолчанию — `Context`, что дает вывод, подобный показанному выше.
`Plain` более компактен и дает меньше информации:
```питон
%xmode Обычный
```
```питон
функция2(1)
```
Режим `Verbose` добавляет некоторую дополнительную информацию, включая аргументы всех вызываемых функций:
```питон
%xmode Подробный
```
```питон
функция2(1)
```
Эта дополнительная информация может помочь вам сузить круг причин возникновения исключения.
Так почему бы не использовать режим `Verbose` постоянно?
По мере усложнения кода обратная трассировка такого рода может стать чрезвычайно длинной.
В зависимости от контекста иногда проще работать с краткостью режима `Plain` или `Context`.
## Отладка: когда чтения трассировок недостаточно
Стандартным инструментом Python для интерактивной отладки является `pdb`, отладчик Python.
Этот отладчик позволяет пользователю построчно пройтись по коду, чтобы увидеть, что может быть причиной более сложной ошибки.
Расширенная версия IPython — `ipdb`, отладчик IPython.
Существует множество способов запуска и использования обоих отладчиков; мы не будем здесь их подробно рассматривать.
Более подробную информацию можно найти в онлайн-документации этих двух утилит.
В IPython, пожалуй, самым удобным интерфейсом для отладки является магическая команда `%debug`.
Если вы вызовете его после возникновения исключения, он автоматически откроет интерактивное окно отладки в точке возникновения исключения.
Командная строка `ipdb` позволяет вам исследовать текущее состояние стека, исследовать доступные переменные и даже запускать команды Python!
Давайте посмотрим на последнее исключение, затем выполним несколько базовых задач. Мы выведем значения `a` и `b`, затем наберем `quit`, чтобы выйти из сеанса отладки:
```питон
%отлаживать
```
Однако интерактивный отладчик позволяет гораздо больше — мы даже можем перемещаться вверх и вниз по стеку и исследовать значения переменных там:
```питон
%отлаживать
```
Это позволяет нам быстро выяснить не только причину ошибки, но и какие вызовы функций привели к ошибке.
Если вы хотите, чтобы отладчик запускался автоматически при возникновении исключения, вы можете использовать магическую функцию `%pdb`, чтобы включить это автоматическое поведение:
```питон
%xmode Обычный
%pdb на
функция2(1)
```
Наконец, если у вас есть скрипт, который вы хотели бы запустить с самого начала в интерактивном режиме, вы можете запустить его с помощью команды `%run -d` и использовать команду `next` для интерактивного пошагового выполнения строк кода.
### Частичный список команд отладки
Существует гораздо больше доступных команд для интерактивной отладки, чем я показал здесь. Следующая таблица содержит описание некоторых наиболее распространенных и полезных из них:
| Команда | Описание |
|---------------|--------------------------------- ----------------------------|
| `l(ist)` | Показать текущее местоположение в файле |
| `h(elp)` | Показать список команд или найти справку по определенной команде |
| `q(uit)` | Выйти из отладчика и программы |
| `c(ontinue)` | Выйти из отладчика, продолжить работу в программе |
| `n(ext)` | Перейти к следующему шагу программы |
| `<enter>` | Повторить предыдущую команду |
| `p(rint)` | Печать переменных |
| `s(tep)` | Шаг в подпрограмму |
| `r(eturn)` | Возврат из подпрограммы |
Для получения дополнительной информации используйте команду `help` в отладчике или ознакомьтесь с [онлайн-документацией] `ipdb` (https://github.com/gotcha/ipdb).