# Магические команды IPython
В предыдущей главе было показано, как IPython позволяет эффективно и интерактивно использовать и исследовать Python.
Здесь мы начнем обсуждение некоторых улучшений, которые IPython добавляет поверх обычного синтаксиса Python.
В IPython они известны как *магические команды* и имеют префикс `%`.
Эти магические команды предназначены для лаконичного решения различных распространенных проблем стандартного анализа данных.
Магические команды бывают двух видов: *строчные магические команды*, которые обозначаются одним префиксом `%` и действуют на одну строку ввода, и *ячеечные магические команды*, которые обозначаются двойным префиксом `%%` и действуют на несколько строк ввода.
Я продемонстрирую и обсужу здесь несколько кратких примеров, а затем вернусь к более предметному обсуждению нескольких полезных магических команд.
## Выполнение внешнего кода: %run
Приступая к разработке более объемного кода, вы, скорее всего, обнаружите, что работаете в IPython для интерактивного исследования, а также в текстовом редакторе для хранения кода, который вы хотите использовать повторно.
Вместо того чтобы запускать этот код в новом окне, может быть удобнее запустить его в сеансе IPython.
Это можно сделать с помощью магической команды `%run`.
Например, представьте, что вы создали файл *myscript.py* со следующим содержимым:
```питон
# файл: myscript.py
определение квадрата(x):
    """возвести число в квадрат"""
    вернуть х ** 2
для N в диапазоне (1, 4):
    print(f"{N} в квадрате равно {square(N)}")
```
Вы можете выполнить это из сеанса IPython следующим образом:
```ipython
В [6]: %run myscript.py
1 в квадрате равно 1
2 в квадрате равно 4
3 в квадрате равно 9
```
Обратите внимание, что после запуска этого скрипта все определенные в нем функции станут доступны для использования в сеансе IPython:
```ipython
В [7]: квадрат(5)
Вышло[7]: 25
```
Существует несколько вариантов тонкой настройки выполнения вашего кода; вы можете просмотреть документацию обычным способом, введя **`%run?`** в интерпретаторе IPython.
## Выполнение кода синхронизации: %timeit
Еще одним примером полезной магической функции является `%timeit`, которая автоматически определяет время выполнения однострочного оператора Python, следующего за ней.
Например, нам может потребоваться проверить производительность понимания списка:
```ipython
В [8]: %timeit L = [n ** 2 для n в диапазоне (1000)]
430 мкс ± 3,21 мкс на цикл (среднее значение ± стандартное отклонение 7 запусков, 1000 циклов каждый)
```
Преимущество `%timeit` в том, что для коротких команд он автоматически выполнит несколько запусков для достижения более надежных результатов.
Для многострочных операторов добавление второго знака `%` превратит это в ячейку-магию, которая может обрабатывать несколько строк ввода.
Например, вот эквивалентная конструкция с циклом `for`:
```ipython
В [9]: %%timeit
   ...: Л = []
   ...: для n в диапазоне (1000):
   ...: L.append(n ** 2)
   ...:
484 мкс ± 5,67 мкс на цикл (среднее значение ± стандартное отклонение 7 запусков, 1000 циклов каждый)
```
Мы сразу видим, что в этом случае списочные генераторы примерно на 10% быстрее, чем эквивалентная конструкция цикла `for`.
Мы рассмотрим `%timeit` и другие подходы к коду синхронизации и профилирования в [Профилирование и хронометрирование кода](01.07-Timing-and-Profiling.ipynb).
## Помощь по магическим функциям: ?, %magic и %lsmagic
Как и обычные функции Python, магические функции IPython имеют строки документации, и это полезно
Доступ к документации можно получить стандартным способом.
Так, например, чтобы прочитать документацию по магической функции `%timeit`, просто введите следующее:
```ipython
В [10]: %timeit?
```
Документацию по другим функциям можно получить аналогичным образом.
Чтобы получить общее описание доступных магических функций, включая некоторые примеры, введите следующее:
```ipython
In [11]: %magic
```
Для быстрого и простого просмотра списка всех доступных магических функций введите следующее:
```ipython
In [12]: %lsmagic
```
Наконец, я хотел бы отметить, что при желании можно довольно просто определить свои собственные магические функции.
Я не буду обсуждать это здесь, но если вам интересно, посмотрите ссылки, перечисленные в [Дополнительные ресурсы IPython](01.08-More-IPython-Resources.ipynb).