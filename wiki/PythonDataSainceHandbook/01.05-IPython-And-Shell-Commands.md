# 01.05-IPython-And-Shell-Commands
## IPython и команды оболочки
Все, что находится после `!` в строке, будет выполнено не ядром Python, а командной строкой системы.
В дальнейшем обсуждении предполагается, что вы используете Unix-подобную систему, например Linux или macOS.
Некоторые из приведенных ниже примеров не будут работать в Windows, где по умолчанию используется другой тип оболочки, хотя если вы используете *Подсистему Windows для Linux*, приведенные здесь примеры должны работать правильно.
## Краткое введение в оболочку
Оболочка — это способ текстового взаимодействия с компьютером. Начиная с середины 1980-х годов, когда Microsoft и Apple представили первые версии своих ныне повсеместно распространенных графических операционных систем, большинство пользователей компьютеров взаимодействовали со своими операционными системами с помощью привычных пунктов меню и перетаскивания.  
Но операционные системы существовали задолго до появления этих графических пользовательских интерфейсов и в основном управлялись посредством последовательностей ввода текста: в ответ на приглашение пользователь вводил команду, а компьютер выполнял то, что говорил ему пользователь. Эти ранние системы подсказок были предшественниками оболочек и терминалов, которые большинство специалистов по обработке данных используют и по сей день.
Кто-то, незнакомый с оболочкой, может спросить, зачем это нужно, если многих из тех же результатов можно добиться, просто нажимая на иконки и меню.
Пользователь оболочки может задать другой вопрос: зачем искать иконки и пункты меню, если гораздо проще все сделать, набрав текст?
Хотя это может показаться типичным тупиком технических предпочтений, при выходе за рамки базовых задач быстро становится ясно, что оболочка предлагает гораздо больше контроля над сложными задачами — хотя, надо признать, кривая обучения может быть пугающей.
В качестве примера приведем образец сеанса оболочки Linux/macOS, в котором пользователь исследует, создает и изменяет каталоги и файлы в своей системе (`osx:~ $` — это приглашение, а все, что после `$` — это введенная команда; текст, которому предшествует `#`, подразумевается просто как описание, а не то, что вы фактически вводите):
```bash
osx:~ $ echo "hello world"             # echo is like Python's print function
hello world

osx:~ $ pwd                            # pwd = print working directory
/home/jake                             # This is the "path" that we're sitting in

osx:~ $ ls                             # ls = list working directory contents
notebooks  projects 

osx:~ $ cd projects/                   # cd = change directory

osx:projects $ pwd
/home/jake/projects

osx:projects $ ls
datasci_book   mpld3   myproject.txt

osx:projects $ mkdir myproject          # mkdir = make new directory

osx:projects $ cd myproject/

osx:myproject $ mv ../myproject.txt ./  # mv = move file. Here we're moving the
                                        # file myproject.txt from one directory
                                        # up (../) to the current directory (./).
osx:myproject $ ls
myproject.txt
```
Обратите внимание, что все это — всего лишь компактный способ выполнения знакомых операций (навигация по структуре каталогов, создание каталога, перемещение файла и т. д.) путем ввода команд, а не нажатия значков и меню.
С помощью всего лишь нескольких команд (`pwd`, `ls`, `cd`, `mkdir` и `cp`) вы можете выполнять многие из наиболее распространенных операций с файлами, но когда вы выходите за рамки этих основ, подход оболочки становится по-настоящему мощным.
## Команды оболочки в IPython
Любую стандартную команду оболочки можно использовать непосредственно в IPython, добавив к ней префикс `!`.
Например, команды `ls`, `pwd` и `echo` можно запустить следующим образом:
```ipython
В [1]: !ls
мойпроект.txt
В [2]: !pwd
/home/jake/projects/мойпроект
В [3]: !echo "печать из оболочки"
печать с оболочки
```
## Передача значений в оболочку и из нее
Команды оболочки можно не только вызывать из IPython, но и заставлять их взаимодействовать с пространством имен IPython.
Например, вы можете сохранить вывод любой команды оболочки в списке Python, используя оператор присваивания `=`:
```ipython
В [4]: ​​содержимое = !ls
В [5]: печать(содержание)
['мойпроект.txt']
В [6]: каталог = !pwd
В [7]: печать(каталог)
['/Пользователи/jakevdp/notebooks/tmp/myproject']
```
Эти результаты возвращаются не в виде списков, а как специальный тип возвращаемого значения оболочки, определенный в IPython:
```ipython
В [8]: тип(каталог)
IPython.utils.text.SList
```
Выглядит и действует во многом как список Python, но имеет дополнительные функции, такие как
методы `grep` и `fields`, а также свойства `s`, `n` и `p`, которые позволяют выполнять поиск, фильтрацию и отображение результатов удобными способами.
Для получения более подробной информации вы можете воспользоваться встроенными справочными функциями IPython.
Связь в обратном направлении — передача переменных Python в оболочку — возможна с использованием синтаксиса `{varname}`:
```ipython
В [9]: сообщение = "привет от Python"
В [10]: !echo {сообщение}
привет от питона
```
Фигурные скобки содержат имя переменной, которое заменяется содержимым переменной в команде оболочки.
## Магические команды, связанные с оболочкой
Если вы поэкспериментируете с командами оболочки IPython, вы можете заметить, что вы не можете использовать `!cd` для навигации по файловой системе:
```ipython
В [11]: !pwd
/home/jake/projects/мойпроект
В [12]: !cd ..
В [13]: !pwd
/home/jake/projects/мойпроект
```
Причина в том, что команды оболочки в блокноте выполняются во временной подоболочке, которая не сохраняет состояние от команды к команде.
Если вы хотите изменить рабочий каталог более надежным способом, вы можете воспользоваться магической командой `%cd`:
```ipython
В [14]: %cd ..
/home/джейк/проекты
```
На самом деле, по умолчанию вы можете использовать это даже без знака `%`:
```ipython
В [15]: cd myproject
/home/jake/projects/мойпроект
```
Это известно как *автоматическая* функция, и возможность выполнять такие команды без явного `%` можно включить с помощью волшебной функции `%automagic`.
Помимо `%cd`, доступны и другие магические функции оболочки: `%cat`, `%cp`, `%env`, `%ls`, `%man`, `%mkdir`, `%more`, `%mv`, `%pwd`, `%rm` и `%rmdir`, любую из которых можно использовать без знака `%`, если включено `automagic`.
Это позволяет обращаться с командной строкой IPython практически так же, как с обычной оболочкой:
```ipython
В [16]: mkdir tmp
В [17]: ls
мойпроект.txt tmp/
В [18]: cp myproject.txt tmp/
В [19]: ls tmp
мойпроект.txt
В [20]: rm -r tmp
```
Такой доступ к оболочке из того же окна терминала, где находится сеанс Python, позволяет более естественно объединять Python и оболочку в рабочих процессах с меньшим количеством переключений контекста.
